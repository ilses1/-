import{A as L,_ as R}from"./CpPaySheet-6d41b4c0.js";import{_ as z}from"./CpIcon-8ee8332b.js";import{_ as E}from"./CpNavBar-aed588de.js";import{_ as G}from"./avatar-doctor-206a2b5c.js";import{c as j,d as q,e as H}from"./consult-544b3527.js";import{f as J}from"./user-b8eb9f76.js";import{d as Q,C as W,x as I,y as X,r as i,a as B,b as D,c as e,e as t,t as T,w as s,f as Y,h as $,z as Z,F as ee,i as te,p as ae,k as oe,_ as se}from"./index-e92d1c66.js";import{a as ne,s as le}from"./function-call-d016c654.js";import"./index-ea992938.js";import{S as ue}from"./index-72ebae05.js";import{s as S,b as ce}from"./request-14faacb8.js";import{C as ie}from"./index-10845d08.js";import{C as re}from"./index-ca072881.js";import{C as pe}from"./index-58a204d1.js";import{B as de}from"./index-366e2f39.js";import"./index-a2f0c7ad.js";import"./use-placeholder-84776c27.js";import"./index-bc427075.js";import"./use-route-70d6c1c8.js";import"./interceptor-a823686a.js";const v=m=>(ae("data-v-0d46f027"),m=m(),oe(),m),_e={key:0,class:"consult-pay-page"},me={class:"pay-info"},ve={class:"tit"},fe=v(()=>t("img",{class:"img",src:G},null,-1)),ye=v(()=>t("p",{class:"desc"},[t("span",null,"极速问诊"),t("span",null,"自动分配医生")],-1)),he=v(()=>t("div",{class:"pay-space"},null,-1)),ge={class:"pay-schema"},Ce=v(()=>t("span",{class:"text"},"支付协议",-1)),we={class:"pay-type"},be={class:"amount"},xe={class:"btn"},ke=Q({__name:"ConsultPay",setup(m){W(()=>{if(d.value)return!1});const V=async()=>{if(r.value===void 0)return S("请选择支付方式");ce({message:"跳转支付",duration:0});const l=await q({orderId:d.value,paymentMethod:r.value,payCallback:"http://localhost:5173/room"});window.location.href=l.data.payUrl},w=te();I(()=>{if(!["type","illnessType","depId","illnessDesc","illnessTime","consultFlag","patientId"].every(h=>n.consult[h]!==void 0))return ne({title:"温馨提示",message:"问诊信息不完整请重新填写，如有未支付的问诊订单可在问诊记录中继续支付！",closeOnPopstate:!1}).then(()=>{w.push("/")});b(),x()});const n=X(),O=()=>le({title:"关闭支付",message:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelButtonText:"仍要关闭",confirmButtonText:"继续支付"}).then(()=>!1).catch(()=>(d.value="",w.push("/user/consult"),!0)),o=i(),b=async()=>{const l=await j({type:n.consult.type,illnessType:n.consult.illnessType});o.value=l.data,n.setCoupon(o.value.couponId)},p=i(),x=async()=>{if(!n.consult.patientId)return;const l=await J(n.consult.patientId);p.value=l.data};I(()=>{b(),x()});const f=i(!1),d=i(""),y=i(!1),_=i(!1),r=i(),U=async()=>{if(!y.value)return S("请勾选我已同意支付协议");f.value=!0;const l=await H(n.consult);d.value=l.data.id,f.value=!1,n.clear(),_.value=!0};return(l,a)=>{var P;const h=E,c=ie,g=re,C=pe,F=ue,k=z,N=de,M=L,A=R;return B(),D(ee,null,[o.value&&p.value?(B(),D("div",_e,[e(h,{title:"支付"}),t("div",me,[t("p",ve,"图文问诊 "+T(o.value.payment)+" 元",1),fe,ye]),e(g,null,{default:s(()=>[e(c,{title:"优惠券",value:`-¥${o.value.couponDeduction}`},null,8,["value"]),e(c,{title:"积分抵扣",value:`-¥${o.value.pointDeduction}`},null,8,["value"]),e(c,{title:"实付款",value:`¥${o.value.actualPayment}`,class:"pay-price"},null,8,["value"])]),_:1}),he,e(g,null,{default:s(()=>[e(c,{title:"患者信息",value:`${p.value.name} | ${p.value.genderValue} | ${p.value.age}岁`},null,8,["value"]),e(c,{title:"病情描述",label:Y(n).consult.illnessDesc},null,8,["label"])]),_:1}),t("div",ge,[e(C,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=u=>y.value=u)},{default:s(()=>[$("我已同意 "),Ce]),_:1},8,["modelValue"])]),e(F,{"button-type":"primary",price:o.value.actualPayment*100,"button-text":"立即支付",loading:f.value,onClick:U,"text-align":"left"},null,8,["price","loading"])])):Z("",!0),e(M,{onCloseOnPopstate:u=>!1,closeable:!1,show:_.value,"onUpdate:show":a[3]||(a[3]=u=>_.value=u),title:"选择支付方式"},{default:s(()=>{var u;return[t("div",we,[t("p",be,"￥"+T((u=o.value)==null?void 0:u.actualPayment.toFixed(2)),1),e(g,null,{default:s(()=>[e(c,{title:"微信支付",onClick:a[1]||(a[1]=K=>r.value=0)},{icon:s(()=>[e(k,{name:"consult-wechat"})]),extra:s(()=>[e(C,{checked:r.value===0},null,8,["checked"])]),_:1}),e(c,{title:"支付宝支付",onClick:a[2]||(a[2]=K=>r.value=1)},{icon:s(()=>[e(k,{name:"consult-alipay"})]),extra:s(()=>[e(C,{checked:r.value===1},null,8,["checked"])]),_:1})]),_:1}),t("div",xe,[e(N,{type:"primary",onClick:V,round:"",block:""},{default:s(()=>[$("立即支付")]),_:1})])])]}),_:1},8,["show"]),e(A,{show:_.value,"onUpdate:show":a[4]||(a[4]=u=>_.value=u),"order-id":d.value,actualPayment:((P=o.value)==null?void 0:P.actualPayment)||1,onClose:O},null,8,["show","order-id","actualPayment"])],64)}}});const je=se(ke,[["__scopeId","data-v-0d46f027"]]);export{je as default};
