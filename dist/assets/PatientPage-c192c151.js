import{_ as J}from"./CpRadioBtn-62ab35da.js";import{_ as K}from"./CpIcon-8ee8332b.js";import{_ as O}from"./CpNavBar-aed588de.js";import{b as Q,e as W,c as X,d as Y}from"./user-b8eb9f76.js";import{F as Z,n as ee,i as ae}from"./rules-777a79d5.js";import{d as te,y as oe,m as B,r as f,x as ne,a as l,b as i,f as m,z as g,c as o,e as n,F as se,v as le,w as u,A as ie,g as ue,h as S,j as de,B as re,n as ce,t as k,p as _e,k as pe,_ as me}from"./index-e92d1c66.js";import{A as ve,a as fe}from"./index-bc427075.js";import{s as ge,a as $,P as he}from"./request-14faacb8.js";import{s as I}from"./function-call-d016c654.js";import{F as Ce}from"./index-013cd62f.js";import{C as ke}from"./index-58a204d1.js";import{B as be}from"./index-366e2f39.js";import"./use-placeholder-84776c27.js";import"./index-a2f0c7ad.js";import"./use-route-70d6c1c8.js";import"./interceptor-a823686a.js";import"./index-10845d08.js";import"./use-id-9e27a97e.js";const b=h=>(_e("data-v-4e73441e"),h=h(),pe(),h),ye={class:"patient-page"},we={key:0,class:"patient-change"},Pe=b(()=>n("h3",null,"请选择患者信息",-1)),Ve=b(()=>n("p",null,"以便医生给出更准确的治疗，信息仅医生可见",-1)),Fe=[Pe,Ve],xe={class:"patient-list"},Be=["onClick"],Se={class:"info"},$e={class:"name"},Ie={class:"id"},Re=["onClick"],Ue={key:0,class:"tag"},Ae=b(()=>n("p",null,"添加患者",-1)),Ne=b(()=>n("div",{class:"patient-tip"},"最多可添加 6 人",-1)),ze={key:1,class:"patient-next"},Le=te({__name:"PatientPage",setup(h){const R=oe(),U=de(),v=B(()=>U.query.isChange==="1"),d=f([]),y=async()=>{const s=await Q();if(d.value=s.data,v.value&&d.value.length){const a=d.value.find(_=>_.defaultFlag===1);a?c.value=a.id:c.value=d.value[0].id}},A=async()=>{if(!c.value)return ge("请选就诊择患者");R.setPatient(c.value),re.push("/consult/pay")};ne(()=>{y()});const N=[{label:"男",value:1},{label:"女",value:0}],w=B({get(){return e.value.defaultFlag===1},set(s){e.value.defaultFlag=s?1:0}}),r=f(!1),V=s=>{if(s){const{id:a,gender:_,name:C,idCard:p,defaultFlag:P}=s;e.value={id:a,gender:_,name:C,idCard:p,defaultFlag:P}}else e.value={...F};r.value=!0},F={name:"",idCard:"",gender:1,defaultFlag:0},e=f({...F}),x=f(),c=f(),z=s=>{v.value&&(c.value=s.id)},L=async()=>{var a;await((a=x.value)==null?void 0:a.validate()),+e.value.idCard.slice(-2,-1)%2!==e.value.gender&&await I({title:"温馨提示",message:`填写的性别和身份证号中的不一致
您确认提交吗？`}),e.value.id?await W(e.value):await X(e.value),r.value=!1,y(),$(e.value.id?"编辑成功":"添加成功")},T=async()=>{e.value.id&&(await I({title:"温馨提示",message:`您确认要删除 ${e.value.name} 患者信息吗 ？`}),await Y(e.value.id),r.value=!1,y(),$("删除成功"))};return(s,a)=>{const _=O,C=K,p=Ce,P=J,D=ke,j=Z,q=ve,E=fe,M=he,G=be;return l(),i("div",ye,[m(v)?(l(),i("div",we,Fe)):g("",!0),o(_,{title:m(v)?"选择患者":"家庭档案"},null,8,["title"]),n("div",xe,[(l(!0),i(se,null,le(d.value,t=>(l(),i("div",{class:ce(["patient-item",{selected:c.value===t.id}]),onClick:H=>z(t),key:t.id},[n("div",Se,[n("span",$e,k(t.name),1),n("span",Ie,k(t.idCard.replace(/^(.{6}).+(.{4})$/,"$1********$2")),1),n("span",null,k(t.genderValue),1),n("span",null,k(t.age)+"岁",1)]),n("div",{onClick:H=>V(t),class:"icon"},[o(C,{name:"user-edit"})],8,Re),t.defaultFlag===1?(l(),i("div",Ue,"默认")):g("",!0)],10,Be))),128)),d.value.length<6?(l(),i("div",{key:0,class:"patient-add",onClick:a[0]||(a[0]=t=>V())},[o(C,{name:"user-add"}),Ae])):g("",!0),Ne]),o(M,{show:r.value,"onUpdate:show":a[5]||(a[5]=t=>r.value=t),position:"right"},{default:u(()=>[o(_,{back:()=>r.value=!1,title:e.value.id?"编辑患者":"添加患者","right-text":"保存",onClickRight:L},null,8,["back","title"]),o(j,{autocomplete:"off",ref_key:"form",ref:x},{default:u(()=>[o(p,{modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.name=t),label:"真实姓名",placeholder:"请输入真实姓名",rules:m(ee)},null,8,["modelValue","rules"]),o(p,{modelValue:e.value.idCard,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.idCard=t),label:"身份证号",placeholder:"请输入身份证号",rules:m(ae)},null,8,["modelValue","rules"]),o(p,{label:"性别",class:"pb4"},{input:u(()=>[o(P,{modelValue:e.value.gender,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.gender=t),options:N},null,8,["modelValue"])]),_:1}),o(p,{label:"默认就诊人"},{input:u(()=>[o(D,{modelValue:m(w),"onUpdate:modelValue":a[4]||(a[4]=t=>ie(w)?w.value=t:null),"icon-size":18,round:""},null,8,["modelValue"])]),_:1})]),_:1},512),e.value.id?(l(),ue(E,{key:0},{default:u(()=>[o(q,{onClick:T},{default:u(()=>[S("删除")]),_:1})]),_:1})):g("",!0)]),_:1},8,["show"]),m(v)?(l(),i("div",ze,[o(G,{type:"primary",onClick:A,round:"",block:""},{default:u(()=>[S("下一步")]),_:1})])):g("",!0)])}}});const ta=me(Le,[["__scopeId","data-v-4e73441e"]]);export{ta as default};
